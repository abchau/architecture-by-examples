= Architecture By Examples
:toc: auto
:toclevels: 5
:imagesdir: docs/images
:imagesoutdir: docs/images

ifdef::env-github[]
:imagesdir: docs/images/
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

== Introduction

This repository demonstrates different architectures by implementing a simple use case. 

== Rationale

* majority of existing examples are often too bulky and too complicated

== Scope

=== In Scope

The application has

* one external *endpoint*
* one *use case*
* one *aggregate*
** one *entity*
** one *value object*
* one database *table*
* four *exceptions*
** one *exception* that can be thrown in presentation layer or application layer or domain layer
** one *exception* that can be thrown in domain layer
** one *exception* that can be thrown in domain layer but requires input from infrastructure layer
** one *exception* that can be thrown in infrastructure layer

=== Out Scope

* does not have a bug free and flawless design
* does not demonstrates how to use various approach to tackle on same problem
* does not demonstrates how to use various design patterns

== Use case

.Single Use case
ifdef::env-github[]
image::use-case.png[]
endif::env-github[]
ifdef::env-idea,env-vscode[]
plantuml::docs/diagrams/use-case.puml[target=use-case,format=png]
endif::env-idea,env-vscode[]

.Database table
[source,sql]
----
CREATE TABLE IF NOT EXISTS subscriptions (
	id BINARY(36) PRIMARY KEY,
	email VARCHAR(512) NOT NULL,
	status VARCHAR(256) NOT NULL,
	created_at TIMESTAMP WITH TIME ZONE NOT NULL,
	last_updated_at TIMESTAMP WITH TIME ZONE NOT NULL,
	version BIGINT NOT NULL
);
----


== How to test

* Import in your favourite IDE
* Start each project as a spring boot application individually
* Go to http://localhost:8080/subscribe
+
image::demo1.png[] 
* *Four* conditions can be tested
** empty input
+
image::demo2.png[] 
** not empty but invalid email format
+
image::demo3.png[] 
** correct email format
+
image::demo4.png[] 
** correct email format but duplicate
+
image::demo5.png[] 

* To verify DB records, go to:
+
[cols="h,4"]
|===
|URL|http://localhost:8080/h2-console
|JDBC URL| `jdbc:h2:mem:testdb`
|username|`sa`
|password|`password`
|===
+
image::demo6.png[] 

== Architectures

[cols="1,1,2,4",options=header]
|===
|#|Name|Architecture|Description
|1
|link:chaos/[chaos]
|Chaos Architecture|A big ball of mud. It's just &#128169; everywhere. (Or should we call it Anarchy Architecture?)
|2
|link:3-tier/[3-tier]
|3-tier Architecture
|Most common way. Easy to understand. Easy to build. Difficult to maintain when it grows bigger.
|3
|link:ddd/[ddd]
|Domain Driven Design|Implement Eric Evan's masterpiece. Best effort to honor original intention
|4
|link:hex/[hex]
|Hexagonal Architecture (Ports and Adapters)|Implement Alistair Cockburn's masterpiece. Best effort to honor original intention
|5
|link:hddd/[hddd]
|Hexagonal Domain Driven Design| Implement DDD using Hexagonal Architecture (also added personal preference)
|===
