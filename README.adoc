= Architecture By Examples
:toc: auto
:toclevels: 5
:imagesdir: docs/images
:imagesoutdir: docs/images

ifdef::env-github[]
:imagesdir: docs/images/
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

== Introduction

This repository demonstrates different architectures by implementing a simple use case. 

== Rationale

* majority of existing examples are often too bulky and too complicated

== Scope

=== In Scope

The application has

* one external *endpoint*
* one *use case*
* one *aggregate*
** one *entity*
** one *value object*
* one database *table*

=== Out Scope

* does not have a bug free and flawless design
* does not demonstrates how to use various approach to tackle on same problem
* does not demonstrates how to use various design patterns

== Use case

.Single Use case
ifdef::env-github[]
image::use-case.png[]
endif::env-github[]
ifdef::env-idea,env-vscode[]
plantuml::docs/diagrams/use-case.puml[target=use-case,format=png]
endif::env-idea,env-vscode[]

.Database table
[source,sql]
----
CREATE TABLE IF NOT EXISTS subscriptions (
	id BINARY(36) PRIMARY KEY,
	email VARCHAR(512) NOT NULL,
	status VARCHAR(256) NOT NULL,
	created_at TIMESTAMP WITH TIME ZONE NOT NULL,
	last_updated_at TIMESTAMP WITH TIME ZONE NOT NULL,
	version BIGINT NOT NULL
);
----


== How to test

* Import in your favourite IDE
* Start each project as a spring boot application individually or run `./mvnw spring-boot:run`
* Go to http://localhost:8080/subscribe
+
image::demo1.png[] 
* *Four* conditions can be tested
** empty input
+
image::demo2.png[] 
** not empty but invalid email format
+
image::demo3.png[] 
** correct email format
+
image::demo4.png[] 
** correct email format but duplicate
+
image::demo5.png[] 

* To verify DB records, go to:
+
[cols="h,4"]
|===
|URL|http://localhost:8080/h2-console
|JDBC URL| `jdbc:h2:mem:testdb`
|username|`sa`
|password|`password`
|===
+
image::demo6.png[] 

== Architectures

[cols="1,1,2,4",options=header]
|===
|#|Name|Architecture|Description
|1
|link:chaos/[chaos]
|Chaos Architecture
a|* A big ball of mud. It's just &#128169; everywhere
* In some sense, it is a failed 3-tier architecture
* Anarchy Architecture might be a better name
|2
|link:3-tier/[3-tier]
|3-tier Architecture
a|* Most common way
* Easy to understand. Easy to build
* Difficult to maintain and lost control when it grows bigger.
|3
|link:ddd/[ddd]
|Domain Driven Design
a|* Implement Eric Evan's masterpiece
* Best effort to honor original intention
* Does not implement Domain Events
|3
|link:3ddd/[3ddd]
|Three-Layered Domain Driven Design
a|* *Simplified* by merging User Interface Layer and Application Layer
* The word *Simplified* doesn't mean easier nor better
* Task coordination have to be done in `Controller` or `Service`
* Differences between combined Application Layer and Domain Model Layer become vague
|5
|link:hex/[hex]
|Hexagonal Architecture (Ports and Adapters)
a|* Implement Alistair Cockburn's masterpiece
* Best effort to honor original intention
* Only implement necessary parts to demostrate idea of using ports and adapters
|6
|link:hddd/[hddd]
|Hexagonal Domain Driven Design
a|* Implement DDD using Hexagonal Architecture
* with personal preference
|===
